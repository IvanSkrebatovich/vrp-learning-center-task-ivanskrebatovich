<apex:page controller="DoctorAppointmentController"
    sidebar="false"
    docType="html-5.0"
    showHeader="false"
    applyBodyTag="true"
    applyHtmlTag="true">

    <style>
        * {
            box-sizing: border-box;
        }
        #contentWrapper {
            min-width: auto !important;
        }
        body {
            margin: 0 !important;
            padding: 30px;
            min-height: 100vh;
            border: solid 5px gray;
            overflow: scroll;
        }
        .paggination + .paggination {
            margin-left: 15px;
        }
    </style>



    <apex:outputPanel id="doctorsAndPatients">
        <apex:form>
            <h3>DOCTORS</h3>
            <div>(Selected Doctor: {!selectedDoctor})</div>
            <apex:selectList value="{!selectedDoctor}" styleClass="selectDoctor" label="Select a Doctor" multiselect="false" size="1" id="select-doctor">
                <apex:selectOptions value="{!doctors}" />
                <apex:actionSupport action="{!rerenderSelectBoxes}" event="onchange" reRender="doctorsAndPatients" />
            </apex:selectList>
            <div>Working Hours Start: {!doctorDetails.Working_Hours_Start__c}</div>
            <div>Working Hours End: {!doctorDetails.Working_Hours_End__c}</div>
            <br/>
        </apex:form>

        <apex:form>
            <h3>PATIENTS</h3>
            <div>(Selected Patient: {!selectedPatient})</div>
            <apex:selectList value="{!selectedPatient}" styleClass="selectPatient" label="Select a Doctor" multiselect="false" size="1" id="select-patient">
                <apex:selectOptions value="{!patients}" />
                <apex:actionSupport action="{!rerenderSelectBoxes}" event="onchange" reRender="doctorsAndPatients" />
            </apex:selectList>
            <br/><br/>
        </apex:form>
    </apex:outputPanel>

    <apex:form>
        <h3>Appointment Date: ({!appointmentDate})</h3><br/>
        <apex:input styleClass="appointmentDate" type="date" value="{!appointmentDate}"/>
        <br/><br/>
        <h3>Appointment Time: ({!appointmentTime})</h3><br/>
        <apex:input styleClass="appointmentTime" type="time" value="{!appointmentTime}"/>
        <br/><br/>
        <h3>Duration in Minutes: ({!appointmentDuration})</h3><br/>
        <apex:input styleClass="appointmentDuration" type="number" value="{!appointmentDuration}"/>
        <br/><br/><br/><br/><br/>
    </apex:form>

    <apex:form>
        <apex:pageBlock title="APPOINTMENTS" id="appointments">
            <apex:commandButton value="Add New Appointment" onclick="createAppointment()" rerender="none"/>
            <br/><br/>
            <apex:pageBlockTable value="{! appointments }" var="a">
                <apex:column value="{! a.Doctor__r.Name }" />
                <apex:column value="{! a.Patient__r.Name }" />
                <apex:column value="{! a.Appointment_Date__c }" />
                <apex:column value="{! a.Duration_in_minutes__c }" />
            </apex:pageBlockTable>
            <br/><br/>
            <apex:commandButton styleClass="paggination" value="Previous" onclick="previousPage()" rerender="none"/>
            <apex:commandButton styleClass="paggination" value="Next" onclick="nextPage()" rerender="none"/>
        </apex:pageBlock>
    </apex:form>



    <script>
        function createAppointment() {
            var target = "{!$RemoteAction.DoctorAppointmentController.createAppointment}";
            var doctor = document.querySelector('.selectDoctor').value;
            var patient = document.querySelector('.selectPatient').value;
            var appointmentTime = document.querySelector('.appointmentTime').value;
            var appointmentDate = document.querySelector('.appointmentDate').value;
            var appointmentDuration = document.querySelector('.appointmentDuration').value;

            var dateTime = `${appointmentDate} ${appointmentTime}` || null;
            var ISOString = (new Date(dateTime)).toISOString();
            
            // var date = (Datetime)json.deserialize('"ISOString"', datetime.class);

            var params = [doctor, patient, dateTime, appointmentDuration*1];
            console.log(params);

            var options = { escape: true };
            var callback = function (result, event) { console.log("RESULT:", result); };
            Visualforce.remoting.Manager.invokeAction(target, ...params, callback, options);
        }
    </script>
</apex:page>
