<apex:page controller="DoctorAppointmentController"
    sidebar="false"
    docType="html-5.0"
    showHeader="false"
    applyBodyTag="true"
    applyHtmlTag="true">

    <style>
        * {
            box-sizing: border-box;
        }
        #contentWrapper {
            min-width: auto !important;
        }
        .newPerson {
            margin-left: 5px !important;
        }
        body {
            margin: 0 !important;
            padding: 30px;
            min-height: 100vh;
            border: solid 5px gray;
            overflow: scroll;
        }
        .paggination {
            min-width: 100px;
        }
        .paggination + .paggination {
            margin-left: 15px;
        }
    </style>



    <apex:outputPanel id="doctorsAndPatients">
        <apex:form>
            <h2>DOCTORS <apex:commandButton styleClass="newPerson" value="New Doctor" onclick="createDoctor()" rerender="none"/></h2>
            <div>(Selected Doctor: {!selectedDoctor})</div>
            <apex:selectList value="{!selectedDoctor}"
                styleClass="selectDoctor" label="Select a Doctor" multiselect="false" size="1" id="select-doctor">
                <apex:selectOptions value="{!doctors}" />
                <apex:actionSupport action="{!rerenderPartitions}" event="onchange" reRender="doctorsAndPatients" />
            </apex:selectList>
            <div>Working Hours Start: {!doctorDetails.Working_Hours_Start__c}</div>
            <div>Working Hours End: {!doctorDetails.Working_Hours_End__c}</div>
            <br/>
        </apex:form>

        <apex:form>
            <h2>PATIENTS <apex:commandButton styleClass="newPerson" value="New Patient" onclick="createPatient()" rerender="none"/></h2>
            <div>(Selected Patient: {!selectedPatient})</div>
            <apex:selectList value="{!selectedPatient}"
                styleClass="selectPatient" label="Select a Doctor" multiselect="false" size="1" id="select-patient">
                <apex:selectOptions value="{!patients}" />
                <apex:actionSupport action="{!rerenderPartitions}" event="onchange" reRender="doctorsAndPatients" />
            </apex:selectList>
            <apex:actionFunction name="rerenderSelectedOptions" rerender="doctorsAndPatients" />
            <br/><br/>
        </apex:form>
    </apex:outputPanel>

    <apex:outputPanel id="dateTimeOptions">
        <apex:form>
            <br/><br/>
            <h3>Appointment Date</h3><br/>
            <apex:input styleClass="appointmentDate" type="date" value="{!appointmentDate}"/>
            <br/><br/>
            <h3>Appointment Time</h3><br/>
            <apex:input styleClass="appointmentTime" type="time" value="{!appointmentTime}"/>
            <br/><br/>
            <h3>Duration in Minutes</h3><br/>
            <apex:input styleClass="appointmentDuration" type="number" value="{!appointmentDuration}"/>
            <br/><br/><br/><br/><br/>
            <apex:actionFunction name="rerenderSelectedOptions" rerender="dateTimeOptions" />
        </apex:form>
    </apex:outputPanel>

    <apex:outputPanel id="appointments">
        <apex:form>
            <apex:pageBlock title="APPOINTMENTS">
                <apex:commandButton value="Add New Appointment" onclick="createAppointment()" rerender="none"/>
                <br/><br/>
                <apex:pageBlockTable value="{! appointments }" var="a">
                    <apex:column>
                        <apex:outputLink value="javascript:void(0);" styleClass="appointmentsView">view</apex:outputLink>
                    </apex:column>
                    <apex:column value="{! a.Doctor__r.Name }" />
                    <apex:column value="{! a.Patient__r.Name }" />
                    <apex:column value="{! a.Appointment_Date__c }" />
                    <apex:column value="{! a.Duration_in_minutes__c }" />
                </apex:pageBlockTable>
                <br/><br/>
                <apex:commandButton styleClass="paggination" value="Previous" onclick="previousPage()" rerender="none"/>
                <apex:commandButton styleClass="paggination" value="Next" onclick="nextPage()" rerender="none"/>
                <apex:actionFunction name="rerenderAppointments" rerender="appointments" />
            </apex:pageBlock>
        </apex:form>
    </apex:outputPanel>



    <script>
        function createAppointment() {
            var doctor = document.querySelector('.selectDoctor').value;
            var patient = document.querySelector('.selectPatient').value;
            var adt = document.querySelector('.appointmentDate').value;
            var atm = document.querySelector('.appointmentTime').value;
            var adr = document.querySelector('.appointmentDuration').value*1;
            var target = "{!$RemoteAction.DoctorAppointmentController.createAppointment}";
            var params = [doctor, patient, `${adt} ${atm}:00`, adr];
            var options = { escape: true };
            Visualforce.remoting.Manager.invokeAction(target, ...params, function (result, event) {
                console.log("RESULT:", result);
                document.querySelector('.selectDoctor').value='';
                document.querySelector('.selectPatient').value='';
                document.querySelector('.appointmentDate').value='';
                document.querySelector('.appointmentTime').value='';
                document.querySelector('.appointmentDuration').value='';
                rerenderAppointments();
                rerenderSelectedOptions();
            }, options);
        }
        // ------------------------------------------------------------
        function createDoctor() {
            console.log('CREATE NEW DOCTOR');
        }
        function createPatient() {
            console.log('CREATE NEW PATIENT');
        }
    </script>
</apex:page>
